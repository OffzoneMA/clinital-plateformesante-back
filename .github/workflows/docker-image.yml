name: Docker Image CI

on:
  push:
    branches: [ "dev" ]
  pull_request:
    branches: [ "dev" ]

jobs:

  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Build the Docker image
      run: docker build . --file Dockerfile --tag my-image-name:$(date +%s)


    deploy:
    runs-on: ubuntu-latest
    needs: build
    steps:
     - name: Download artifact
     uses: actions/download-artifact@master
     with:
	     name: bundle
       path: ./dist
       
  	 - name: Deploy project with SSH
     uses: easingthemes/ssh-deploy@v2.1.4
     env:
	     SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
       REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
       REMOTE_USER: ${{ secrets.REMOTE_USER }}
       SOURCE: "dist"
       TARGET: "~/"
